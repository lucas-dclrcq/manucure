<!DOCTYPE html>
<html lang="EN">
<head>
    <title>Manucure</title>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <link rel="stylesheet" href="/assets/tailwind.min.css">
    <link rel="stylesheet" href="/assets/tabler-icons.min.css">
    <script>
        const loadTheme = () => {
            // On page load or when changing themes, best to add inline in `head` to avoid FOUC
            if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.documentElement.classList.add('dark')
            }
        }
    </script>
</head>
<body class="dark:bg-slate-600 dark:text-slate-100" onload="loadTheme()">
<div id="search-background" class="-z-50 w-full h-full absolute">
    <div id="search-container"
         class="relative bg-white invisible left-1/2 top-1/4 -translate-x-1/2 -translate-y-1/4 w-2/5 h-4/6 dark:bg-slate-600 dark:text-slate-100">
        <div id="search-content">
            <div id="searchbox"></div>
            <div id="hits"></div>
        </div>
    </div>
</div>
{% block content %}
{% endblock %}
</body>
<script src="/assets/instant-meilisearch.umd.min.js"></script>
<script src="/assets/instantsearch.production.min.js"></script>
<script>
    const search = instantsearch({
        indexName: "{{user_index}}",
        searchClient: instantMeiliSearch(
            '{{meili_url|safe}}',
            '{{meili_secret|safe}}',
            {
                primaryKey: 'id',
                finitePagination: true,
            }
        )
    });
</script>
<script src="/assets/search.js"></script>
<script>
    const initSearch = () => {
        let search = document.getElementById("search-background");
        search.classList.add("backdrop-blur-sm");
        search.classList.remove("-z-50");
        let wrapper = document.getElementById("search-container");
        wrapper.classList.remove("invisible");
        let closeSearchOnClick = function (e) {
            let container = document.getElementById('search-content');
            if (!container.contains(e.target)) {
                quitSearch(closeSearchOnClick);
            }
        };

        let closeSearchEscPressed = function (e) {
            if (e.key === "Escape") {
                quitSearch(closeSearchEscPressed)
            } else {
                return true;
            }
        };

        document.addEventListener('keydown', closeSearchEscPressed);
        document.addEventListener('click', closeSearchOnClick);
    }
    const quitSearch = (listener) => {
        let search = document.getElementById("search-background");
        search.classList.remove("backdrop-blur-sm");
        search.classList.add("-z-50");
        let wrapper = document.getElementById("search-container");
        wrapper.classList.add("invisible");
        document.removeEventListener("click", listener)
    }

    window.addEventListener('keydown', (event) => {
        const keyName = event.key;
        let search = document.getElementsByClassName("ais-SearchBox-input");
        let searchInput = search.item(0);
        if (event.ctrlKey && keyName === "k") {
            initSearch()
            event.preventDefault();
            searchInput.focus();
        } else if (event.key === "Escape") {
            searchInput.blur();
        } else {
            return true;
        }
    });
</script>
</html>

